<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Contributing · Terrarium.jl</title><meta name="title" content="Contributing · Terrarium.jl"/><meta property="og:title" content="Contributing · Terrarium.jl"/><meta property="twitter:title" content="Contributing · Terrarium.jl"/><meta name="description" content="Documentation for Terrarium.jl."/><meta property="og:description" content="Documentation for Terrarium.jl."/><meta property="twitter:description" content="Documentation for Terrarium.jl."/><meta property="og:url" content="https://tum-pik-esm.github.io/Terrarium.jl/stable/contributing/"/><meta property="twitter:url" content="https://tum-pik-esm.github.io/Terrarium.jl/stable/contributing/"/><link rel="canonical" href="https://tum-pik-esm.github.io/Terrarium.jl/stable/contributing/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Terrarium.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox"/><label class="tocitem" for="menuitem-2"><span class="docs-label">Overview</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../overview/mathematical_formulation/">Mathematical formulation</a></li><li><a class="tocitem" href="../overview/software_architecture/">Software architecture</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">Physics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-1" type="checkbox"/><label class="tocitem" for="menuitem-3-1"><span class="docs-label">Soil physics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../physics/soil_energy_water/">Energy and water balance</a></li></ul></li><li><a class="tocitem" href="../physics/vegetation/">Vegetation</a></li></ul></li><li class="is-active"><a class="tocitem" href>Contributing</a><ul class="internal"><li><a class="tocitem" href="#Software-development-practices"><span>Software development practices</span></a></li></ul></li><li><a class="tocitem" href="../api_reference/">API Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Contributing</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Contributing</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/TUM-PIK-ESM/Terrarium.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/TUM-PIK-ESM/Terrarium.jl/blob/main/docs/src/contributing.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Contributing"><a class="docs-heading-anchor" href="#Contributing">Contributing</a><a id="Contributing-1"></a><a class="docs-heading-anchor-permalink" href="#Contributing" title="Permalink"></a></h1><p>We gladly welcome any and all contributions to Terrarium.jl. Building a new land model is a huge undertaking that no single developer or scientist can hope to achieve alone. Collaboration always has been and always will be key to building good geoscientific models. Terrarium is no exception to this, and its success will depend on the contributions of the broader community.</p><p>There are multiple ways in which you could consider contributing to the project:</p><ul><li>If you have a question or an idea, raise an issue or start a discussion on the GitHub repository.</li><li>If you want to try implementing something, clone the repository and make a pull request. Please take note of our <a href="#Software-development-practices">Software development practices</a> below.</li><li>If you&#39;re not able to directly contribute yet but would like to support our work, consider sharing the GitHub repository (or this documentation) with others who you think might be interested.</li></ul><p>Regardless of how you choose to contribute, we thank you for your participation, and we look forward to working with you!</p><h2 id="Software-development-practices"><a class="docs-heading-anchor" href="#Software-development-practices">Software development practices</a><a id="Software-development-practices-1"></a><a class="docs-heading-anchor-permalink" href="#Software-development-practices" title="Permalink"></a></h2><h3 id="Automated-testing-and-continuous-integration"><a class="docs-heading-anchor" href="#Automated-testing-and-continuous-integration">Automated testing and continuous integration</a><a id="Automated-testing-and-continuous-integration-1"></a><a class="docs-heading-anchor-permalink" href="#Automated-testing-and-continuous-integration" title="Permalink"></a></h3><p>Terrarium.jl adheres to software development standards for automated testing via continuous integration. We write unit tests for every function of our model. In some cases this might appear trivial, but we still want to achieve a near complete coverage of our code in the tests. The majority of the tests should cover the smallest possible units over different input arguments and types (if applicable). Unit tests should typically call the tested functions in a way that is representative for their use in the model, but try to reduce the computational complexity (e.g. by choosing very low dimensional inputs) to keep the overall CI time manageable. Additionally, we have some tests that ensure top-level functionality and stability of the model as well. Every additional proposed feature in a Pull Request has to come with unit tests. Tests verifying differentiability and GPU compatibility will also be requried.</p><h3 id="Kernel-programming"><a class="docs-heading-anchor" href="#Kernel-programming">Kernel programming</a><a id="Kernel-programming-1"></a><a class="docs-heading-anchor-permalink" href="#Kernel-programming" title="Permalink"></a></h3><p>Terrarium.jl is a device-agnostic model that runs on CPUs and GPUs by using <a href="https://github.com/JuliaGPU/KernelAbstractions.jl">KernelAbstractions.jl</a>. This means that most computations need to be implemented within kernel functions that follow KernelAbstractions’ syntax. Each thread in the CPU or GPU will then compute the discretized equations for a single grid point.</p><p>For writing kernels we follow a strategy closely inspired by Oceaninanigans.jl: we want to fuse kernels as much as possible. Kernel fusion means that in practice we write very “large” kernels that fuse as many operations as possible together in one kernel. Kernel fusion leads to more efficient GPU computations, especially by reducing memory demand (<a href="https://ieeexplore.ieee.org/document/5724850/">Wang et. al 2000</a>). In order to still keep our code well structured and modular, our approach relies on implementing most processes as inlined functions that can be called from a GPU kernel. We have not yet found any significant limitations to this approach.</p><p>How this looks in action in Terrarium.jl you can already see in the prototype code, e.g. for the <a href="https://github.com/TUM-PIK-ESM/Terrarium.jl/blob/main/src/processes/soil/soil_energy.jl">SoilEnergyBalance</a>: There <code>compute_tendencies!</code> is the mandatory function for the model component, it launches exactly one kernel <code>compute_energy_tendency!</code>, which includes several <code>@inline</code> function to compute individual contributions to the energy balance such as <code>energy_tendency</code>, <code>thermalconductivity</code> and the <code>diffusive_heat_flux</code>.</p><p>It&#39;s also worth checking out the <a href="https://clima.github.io/OceananigansDocumentation/stable/simulation_tips/">Simulation tips</a> provided in the documentation for Oceananigans.</p><h3 id="Automatic-Differentiation-with-Enzyme"><a class="docs-heading-anchor" href="#Automatic-Differentiation-with-Enzyme">Automatic Differentiation with Enzyme</a><a id="Automatic-Differentiation-with-Enzyme-1"></a><a class="docs-heading-anchor-permalink" href="#Automatic-Differentiation-with-Enzyme" title="Permalink"></a></h3><p>For AD, we rely primarily on reverse mode differentiation via <a href="https://enzyme.mit.edu/julia/stable/">Enzyme.jl</a>. In contrast to many other AD systems, Enzyme doesn’t put particularly strong restrictions on coding style. For example, Array mutations are not only allowed, they are even encouraged!</p><p>There is one thing however, that is crucial for Enzyme to work: <a href="https://docs.julialang.org/en/v1/manual/faq/#man-type-stability">type stability</a>. The code absolutely has to be type stable, even in parts that are performance non-critical. Every occurrence of type instability may break differentiability with Enzyme. If this happens, we recommend first quickly checking for type instability of core function calls using <code>@code_warntype</code> and <code>@inferred</code> in unit tests. Then, if the issue is not yet apparent, debug the code using <a href="https://github.com/JuliaDebug/Cthulhu.jl">Cthulhu.jl</a>. Cthulhu is an awesome tool to interactively inspect your code for type instabilities and it is extremely easy to run: just preempt the function that you are trying to differentiate with <code>@descend</code> after loading the <code>Cthulhu</code> package.</p><p>Enzyme does, however, have some disadvantages; it is still not fully mature and bugs do occur. As of the time of writing (August 2025), this is especially the case for Julia 1.11. We currently recommend staying on Julia 1.10.10 (LTS) for the time being. Other cryptic Enzyme error messages have become rarer with time, but they do still occasionally happen. In these cases, we, along with our AD team led by Valentin in the DELTA-ESM project, are happy to offer support to the best of our abilities.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../physics/vegetation/">« Vegetation</a><a class="docs-footer-nextpage" href="../api_reference/">API Reference »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Friday 17 October 2025 14:01">Friday 17 October 2025</span>. Using Julia version 1.10.10.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
