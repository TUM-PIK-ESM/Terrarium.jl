<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Software architecture · Terrarium.jl</title><meta name="title" content="Software architecture · Terrarium.jl"/><meta property="og:title" content="Software architecture · Terrarium.jl"/><meta property="twitter:title" content="Software architecture · Terrarium.jl"/><meta name="description" content="Documentation for Terrarium.jl."/><meta property="og:description" content="Documentation for Terrarium.jl."/><meta property="twitter:description" content="Documentation for Terrarium.jl."/><meta property="og:url" content="https://tum-pik-esm.github.io/Terrarium.jl/stable/overview/software_architecture/"/><meta property="twitter:url" content="https://tum-pik-esm.github.io/Terrarium.jl/stable/overview/software_architecture/"/><link rel="canonical" href="https://tum-pik-esm.github.io/Terrarium.jl/stable/overview/software_architecture/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Terrarium.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox" checked/><label class="tocitem" for="menuitem-2"><span class="docs-label">Overview</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../mathematical_formulation/">Mathematical formulation</a></li><li class="is-active"><a class="tocitem" href>Software architecture</a><ul class="internal"><li><a class="tocitem" href="#Numerical-implementation"><span>Numerical implementation</span></a></li><li><a class="tocitem" href="#The-AbstractModel-interface"><span>The AbstractModel interface</span></a></li><li><a class="tocitem" href="#State-variables"><span>State variables</span></a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">Physics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-1" type="checkbox"/><label class="tocitem" for="menuitem-3-1"><span class="docs-label">Soil physics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../physics/soil_energy_water/">Energy and water balance</a></li></ul></li><li><a class="tocitem" href="../../physics/vegetation/">Vegetation</a></li></ul></li><li><a class="tocitem" href="../../contributing/">Contributing</a></li><li><a class="tocitem" href="../../api_reference/">API Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Overview</a></li><li class="is-active"><a href>Software architecture</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Software architecture</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/TUM-PIK-ESM/Terrarium.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/TUM-PIK-ESM/Terrarium.jl/blob/main/docs/src/overview/software_architecture.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Software-architecture"><a class="docs-heading-anchor" href="#Software-architecture">Software architecture</a><a id="Software-architecture-1"></a><a class="docs-heading-anchor-permalink" href="#Software-architecture" title="Permalink"></a></h1><div class="admonition is-warning" id="Under-construction-7ef76cf81de44810"><header class="admonition-header">🚧🚧 Under construction 🚧🚧<a class="admonition-anchor" href="#Under-construction-7ef76cf81de44810" title="Permalink"></a></header><div class="admonition-body"><p>The architecture of Terrarium.jl is still in an early prototype stage and is the subject of ongoing discussion. This page is a non-exhaustive summary of the current working concept and will be updated accordingly if and when the architecture changes.</p></div></div><h2 id="Numerical-implementation"><a class="docs-heading-anchor" href="#Numerical-implementation">Numerical implementation</a><a id="Numerical-implementation-1"></a><a class="docs-heading-anchor-permalink" href="#Numerical-implementation" title="Permalink"></a></h2><p>Terrarium is based on the numerics and finite-volume method operators provided by Oceananigans.jl. All state variables are represented as Oceananigans Fields with computations automatically distributed using KernelAbstractions.jl. Spatial grids in Terrarium are similarly based on the corresponding Oceananigans grids, most prominently the RectilinearGrid which represents a rectangular volume divided orthogonally into smaller control volumes along the X, Y, and Z dimensions.</p><h2 id="The-AbstractModel-interface"><a class="docs-heading-anchor" href="#The-AbstractModel-interface">The AbstractModel interface</a><a id="The-AbstractModel-interface-1"></a><a class="docs-heading-anchor-permalink" href="#The-AbstractModel-interface" title="Permalink"></a></h2><p>A “model” in Terrarium represents a collection of parameters and process types that characterize a simulation. All models must be defined as <code>struct</code>s that subtype <code>AbstractModel</code> and will typically consist of the following fields/properties:</p><ul><li>A grid that defines the discretization of the spatial domain</li><li>An initializer responsible for initializing state variables</li><li>One or more processes and/or sub-models that define the state variables and the dynamics of the system</li></ul><p>The distinction between what constitutes a “model” versus a “process” should be based on whether or not there is a use case for running simulations of that model/process independently from other processes. Models should be built to be independently runnable standalone in a <code>Simulation</code>, while process types simply provide the concrete implementations of the physical processes to be included in a model. Since Terrarium models are composable, it should generally be trivial to convert a process into a full standalone model later (if necessary) without affecting the other model components that depend on it.</p><p>All <code>AbstractModel</code> and <code>AbstractProcess</code> types must additional provide dispatches for the following methods:</p><ul><li><code>variables(::Model)</code> returns a tuple of variable metadata declaring the state variables. Variables must be one of two types: prognostic or auxiliary (sometimes referred to as “diagnostic”). Prognostic variables fully characterize the state of the system at any given timestep and are updated according to their tendencies (i.e. <span>$G$</span> in the aforementioned equation). Tendencies are automatically allocated for each prognostic variable declared by the model.</li><li><code>compute_auxiliary!(state, ::Model)</code> computes the values of all auxiliary variables (if necessary) assuming that the prognostic variables of the system in <code>state</code> are available for the current timestep.</li><li><code>compute_tendencies!(state, ::Model)</code> computes the tendencies based on the current values of the prognostic and auxiliary variables stored in <code>state</code>.</li></ul><p>In addition, <code>AbstractModel</code>  implementations must also provide dispatches for the following methods:</p><ul><li><code>initialize!(state, ::Model, ::Initializer)</code> computes any necessary initialization of the model state based on the user-supplied configuration and parameter settings. The additional initializer argument is extracted from the model and allows for alternative dispatches based on various initialization schemes for each model.</li><li><code>timestep!(state, ::Model, ::TimeStepper, dt)</code> updates the prognostic state variables according to the given timestepping scheme. This method can and should be implemented generically for any timestepping scheme but allows for model-specific overrides where necessary.</li><li><code>get_grid(::Model)</code> returns the spatial grid associated with the model. A default implementation is provided which assumes that the model defines a field named <code>grid</code>.</li><li><code>get_initializer(::Model)</code> returns the initializer for the model. A default implementation is provided which assumes that the model defines a field named <code>initializer</code>.</li></ul><h2 id="State-variables"><a class="docs-heading-anchor" href="#State-variables">State variables</a><a id="State-variables-1"></a><a class="docs-heading-anchor-permalink" href="#State-variables" title="Permalink"></a></h2><p>State variables are realized as Oceananigans <code>Field</code>s defined over the model grid. Each variable returned by the <code>variables</code> method will be allocated a corresponding <code>Field</code> with boundary conditions and initial values specified by one or more <code>AbstractInitializer</code>s defined on the model. This allocation occurs when creating a <code>Simulation</code> by calling  <code>initialize(model)</code>. The resulting <code>Simulation</code> object will have a property <code>state</code> of type <code>StateVariables</code> which holds all of the <code>Field</code>s for each state variable defined by the model.</p><p>As an example, suppose we are implementing a new model <code>MyModel</code> and we want to define the necessary state variables. We do this by defining a new dispatch of the <code>variables</code> method:</p><pre><code class="language-julia hljs">variables(::MyModel) = (
	prognostic(:progvar, XYZ()),
	auxiliary(:auxvar, XYZ()),
	auxiliary(:bc, XY()),
)</code></pre><p>This will result in a total of four state variables being allocated when <code>initialize(model)</code> is called: two auxiliary variables named <code>auxvar</code> and <code>bc</code> as well as one prognostic variable named <code>progvar</code> along with its tendency <code>progvar_tendency</code> which is created automatically. The second argument to the variable metadata constructors <code>prognostic</code> and <code>auxiliary</code> is a subtype of <code>VarDims</code> which specifies on which spatial dimensions the state variable should be defined. <code>XYZ()</code> corresponds to a 3D <code>Field</code> which is discretized both laterally (along spatial grid cells) and along the vertical axis. Currently, Terrarium only supports a single 3D grid representing variables defined in the soil domain, though this may change in the near future in order to accommodate multi-layer snow and canopy processes. <code>XY()</code> corresponds to a 2D field which is discretized along the lateral dimension only. Note that Terrarium also currently supports only 1D (vertical) dynamics so all grid cells on the X and Y axes will be assumed independent. This is equivalent to what is typically called a <em>single column</em> model, or <em>column-based parameterization</em> in atmosphere and ocean modeling. However, building on Oceananigans means that we have a clear path to relax this assumption in the future!</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../mathematical_formulation/">« Mathematical formulation</a><a class="docs-footer-nextpage" href="../../physics/soil_energy_water/">Energy and water balance »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Friday 17 October 2025 06:01">Friday 17 October 2025</span>. Using Julia version 1.10.10.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
